# CH4 데이터 모델링

## 1. 데이터 모델링과 데이터 모델의 개념 


> Q. 데이터 모델링의 개념

- 데이터 모델링이란 현실세계에서 존재하는 데이터를 컴퓨터 세계의 데이터베이스로 옮기는 변환 과정을 의미한다. 
- 데이터 모델링에는 개념적 모델링과 논리적 모델링이 필요하다.
- 개념적 모델링 : 변환 과정에는 추상화 작업이 필요하다. 관리할만한 중요 데이터만 찾아 데이터베이스에 저장하는 것이다. 
- 논리적 모델링 : 저장 구조를 고려하여 개념 데이터를 데이터베이스에 저장하는 것이다. 


> Q. 데이터 모델의 개념

- 데이터 구조, 연산, 제약조건으로 구성되며 데이터 모델링의 결과를 표현하는 도구로 사용된다. 
- 데이터 구조는 변하지 않고 정적인 특징이 있다. 
- 연산은 데이터 구조에 따라 실제 세계와 컴퓨터 세계에서 표현된 값들을 처리하는 작업으로 연산에 의해 값이 변경될 수 있다. 
- 제액조건은 데이터 무결성을 위해 존재한다. 



## 2. 개체 - 관계 모델 


> Q. 개체-관계 모델의 개념

- 개체(entity)와 개체 간의 관계를 이용해 현실 세계를 개념적 구조로 표현하는 것이다. 
- 해당 모델을 모델링하여 그림으로 표현한 것을 E-R Diagram이라고 한다. 


> Q. 개체에 대해서 설명하세요 

- 현실에서 사람과 사물과 같이 구별되는 모든 것이다. 저장할만한 가치가 있는 중요 데이터를 갖고 있는 사람이나 사물을 의미한다 
- 예를 들어 서점을 개념적 모델링 한다고 할 때 : 고객, 책이 개체가 된다. 
- 학교 운영을 개념적 모델링을 한다고 할 때 : 학과, 과목은 추상적이지만 반드시 필요한 개념으로 개체가 된다. 
- 고유한 특성을 하나 이상 가지고 있다. 
- ERD에서 개체는 직사각형으로 표현한다


> Q. 속성에 대해 설명하세요

- 개체가 가지고 있는 고유한 특성이다. 
- 일반적으로 의미있는 데이터의 가장 작은 논리적 단위로 인식된다. 
- ERD에서 속성은 타원으로 표현한다. 



> Q. 속성을 다양한 기준을 분류하라

- 속성값의 개수로 분류할 수 있다 
  - 단일값 속성 : 특정 객체를 구성하는 속성 값이 하나면 단일 값 속성으로 분류한다. 고객의 이름, 적립금등의 속성은 한명의 고객 인스턴스에 대해 하나의 값만 가지기 때문이다. 
  - 다중값 속성 : 속성값이 여러개 있다면 다중 값 속성으로 분류한다. 예를 들어 고객 객체의 연연 락처 속성은 집전화번호와 휴대폰 번호등으로 여러개 가질 수 있기 때문에 다중값 속성이다. ERD에서 이중 타원으로 표현한다. 
- 의미의 분해 가능성
  - 단순 속성 : 의미를 더는 분해할 수 없는 속성이다. 예를들어 책 개체를 구성하는 이름, ISBN 가격은 의미를 더 나눌 수 없다.
  - 복합 속성 : 의미를 분해하여 여러개의 의미를 포함하는 것을 의미한다. 주소 속성은 도시, 동, 우편번호등으로 의미를 나눌 수 있다. 가지치기를 통해 여러개의 속성으로 나뉠 수 있음을 표현할 수 있다. 
- 기존 속성 값에서 유도
  - 유도 속성 : 기존의 다른 속성 값에서 유도되어 결정되는 속성을 의미한다. 예를 들어 책의 판매가격은 책 개체를 구성하는 가격과 할인율 속성으로 계산되는 것이다. 
  - 저장 속성 : 직접적으로 데이터베이스에 저장되는 속성을 의미한다. 단가와 수량은 저장 속성이다. 



> Q. 널 속성과 키 속성에 대해 설명하라

- 널 속성(Null)
  - 아직 결정되지 않았거나, 값을 모르거나, 존재하지 않는 값이다. 
  - 따라서 공백, 0과는 의미가 다르다
  - 널값이 허용되는 속성을 널속성이라고 한다. 
- 키 속성
  - 개체 집합에 존재하는 각 개체 인스턴스들을 식별하는데 사용된다. 
  - 개체타입 정의 시 키값으로 개체 인스턴스를 식별할 수 있어야 한다. 
  - ERD에서는 밑줄을 그어 표현한다. 



> Q. 관계에 대해 설명하세요

- 개체간의 의미있는 연관성을 의미한다. 매핑이라고도 한다. 
- 관계도 개체 처럼 속성을 가질 수 있다. 예를들어 고객이라는 객체와 책이라는 객체는 구매라는 관계로 매핑될 수 있는데, 이 사이에 구매일자, 결제방식등이 구매관계의 속성이 될 수 있다. 
- ER다이어그램에서 마름모로 표현된다. 


> Q. 관계의 유형에 대해 설명하세요

- 관계의 분류 기준을 매핑 원소의 수로 한다. 이를 매핑카디널리티라고 한다. 
- 일 대 일 (1:1)
  - 개체 A의 각 개체 인스턴스가 개체 B의 개체 인스턴스 하나와 관계를 맺는 것이다. 
  - 남편과 아내 사이에 혼인관계가 존재하고 두 개체관계는 1:1관계이다.
- 일 대 다 (1:n)
  - 개체 A의 각 개체 인스턴스는 개체 B의 개체 인스턴스와 여러 개 관계를 맺는 것이다. 
  - 예를들어 부서 개체와 사원 개체 사이에는 소속이라는 관계가 존재하고 한 부서에 여러 사원이 존재하므로 1:n관계이다.
- 다 대 다 (n:m)
  - 개체 A의 여러 개체 인스턴스가 개체 B의 단일 혹은 여러 인스턴스와 관계를 맺는 것을 의미한다.
  - 예를 들어 고객 과 책 개체 사이에는 구매라는 관계가 존재하고 한 사람이 여러 종류의 책을 살 수 있고, 책은 여러 고객에게 판매 될 수 있다.  


> Q. 관계의 특성에 대해서 설명하세요

- 참여 
  - 전체 참여, 선택적 참여(부분참여) 등의 특성이 있다. 
- 종속성 
  - 객체 B가 객체 A에 대해 의존적이라면 A에 대해 종속되어있다고 표현한다. 이런 경우 존재종속이라고 한다. 
  - 해당 예시에서 B는 약한 객체, A를 강한 객체라고 표현한다. 
  - 예를들어 학교라는 입장에서 학부모 객체는 의미가 없고 학생이 존재해야 한다. 따라서 학생이 졸업하면 학부모 데이터도 함께 사라진다. 
  - 일반적으로 일대다 관계를 지니며 약한 개체는 강한 개체와의 관계에 필수적으로 참여한다는 특징이 있다. 
  - 약한 객체는 이중 사각형으로 표현하고 약한 객체와 강한 객체간의 관계는 이중 마름모로 표현하며 필수적으로 참여하는 관계에 이중선으로 표현한다. 




## 3. 논리적 데이터 모델 


> Q. 논리적 데이터 모델에 대해 설명하세요

- 관리 시스템에 따라 그린 E-R 다이어그램을 데이터베이스에 어떻게 저장할지 논리적으로 표현한 결과물이다. 
- 이를 데이터베이스 스키마라고도 한다. 
- 주로 관계 데이터 모델을 사용하며 2차원 테이블 형태이다. 


> Q. 계층 데이터 모델과 네트워크 데이터 모델에 대해 설명해보세요

- 계층 데이터 모델 : 
  - 데이터베이스의 논리 구조가 트리 형태인 모델이다. 
  - 개체간 관계는 링크로 나타내는데 링크는 일대다 관계만 표현할 수 있다.
  - 두 개체 사이에 관계는 하나만 정의할 수 있어 관계에 이름을 붙여 구분할 필요가 없다.
  - 다대가 관계를 직접 표현할 수 없고 별도의 개체를 추가로 생성하여 이를 표현한다. 
- 네트워크 데이터 모델 
  - 데이터 베이스의 논리구조가 그래프 형태/네트워크 형태인 모델이다. 
  - 개체간 관계를 화살표로 나타내고 화살표는 일대다 관계만 표현할 수 있다. 
  - 두개체간 관계를 여러개 정의할 수 있어 관계를 이름으로 구별한다. 
  - 두 개체사이의 일대다 관계를 이용해 다대다 관계를 표현한다. 


# CH5 관계 데이터 모델 


## 1. 관계 데이터 모델의 개념  

한개의 개체에 대한 데이터를 릴레이션 하나에 담아 데이터베이스에 저장한다. 

> Q. 기본 용어에 대해 설명해보세요

- 속성
  - 릴레이션의 열을 속성 또는 attribute라고 한다
  - 고객 아이디, 고객 이름, 나이, 등급 직업, 적립금이 있다. 
  - 칼럼
- 튜플 (tuple)
  - 릴레이션의 행을 튜플이라고 한다. 
  - 고객 개체의 인스턴스이며 record에 대응하는 개념이다. 
- 도메인 (domain)
  - 속성 하나가 가질 수 있는 모든 값의 집합을 해당 속성의 도메인이라고 한다.
  - 예를들어 등급에 vip, gold, silver, bronze만 있다고 하면 네가지를 모아둔 것이 등급의 도메인이다. 
  - 정의해두면 사용자가 속성값을 입력하거나 수정할 때 데이터베이스 시스템이 적합성을 판단하여 네가지 이외의 값을 허용하지 않고 올바른 값을 유지할 수 있다는 장점이 있다.
  - 고객 이름의 도메인을 CHAR(20), 나이를 INT로 정해두는 것도 도메인이다. 
  - 데이터타입을 도메인, 변수를 속성으로 생각하면 쉽다. 
- 널값 (null)
  - 속성값을 모르거나 적합한 값이 없는 경우 사용할 수 있다.
- 차수 (degree)
  - 하나의 릴레이션에서 속성 전체의 개수를 의미한다.
  - 최소 1개 이상의 차수를 유지해야 한다. 
- 카디널리티 (cardinality)
  - 튜플의 전체 개수를 의미한다. 
  - 튜플이 없는 릴레이션이 존재할 수 있다. 
  - 삽입, 삭제가 자유로워 값이 자주 변한다는 동적인 특징이 있다. 


> Q. 관계 데이터 모델의 구성에 대해 말해보세요

- 릴레이션 스키마와 릴레이션 인스턴스로 구성되어 있습니다 
- 릴레이션 스키마 
  - 릴레이션의 이름과 릴레이션에 포함된 모든 속성을 이름으로 정의하는 논리 구조이다
  - 전체 구조를 쉽게 파악할 수 있다는 특징이 있다. 
- 릴레이션 인스턴스 
  - 어느 한 시점에 릴레이션에 존재하는 투플의 집합이다. 


> Q. 릴레이션의 특성 4가지를 말해보세요

1. 튜플의 유일성 : 하나의 릴레이션에는 동일한 튜플이 존재할 수 없다 
2. 튜플의 무순서 : 하나의 릴레이션에서 튜플사이의 순서는 무의미하다 
3. 속성의 무순서 : 하나의 릴레이션에서 속성 사이의 순서는 무의미하다 
4. 속성의 원자성 : 속성 값으로 원자 값만 사용할 수 있다. 



> Q. 키에 대해서 설명하세요 

- 키(key)는 릴레이션에 포함된 튜플을 유일하게 구별해주는 역할을 한다. 



> Q. 키의 종류를 분류하여 설명하세요 

1. 슈퍼키 (super key)
- 유일성의 특성을 만족하는 속성, 속성의 집합을 의미한다.
- 키값이 같은 튜플은 존재할 수 없다. 
- ex :) 고객 아이디, 고객아이디를 포함하는 속성집합(고객아이디, 고객이름이 동시에 묶인 속성)

2. 후보키 (candidate key)
- 유일성과 최소성을 만족하는 속성, 속성들의 집합
- 고객 아이디 속성은 단독으로 고객 튜플을 구별할 수 있어 후보키가 되지만 (고객아이디, 고객이름)은 후보키가 될 수 없다. 
- 후보키는 새로운 튜플이 삽입, 삭제되어도 유지되어야 한다. 
- 따라서 현재 릴레이션만 보고 유일성과 최소성을 판단해서는 안된다. 

3. 기본키 (primary key)
- 후보키중에서 기본으로 사용할 키를 선택
- 고객 아이디 속성만 후보키라고 했을 때, 이를 기본키로 설정하고 밑줄을 그어 표현한다. 
- 기본키가 될 수 있는 기준
  - 널 값을 가질 수 있는 속성이 포함된 후보키는 기본키로 부적합하다. 
  - 값이 자줄 변경될 수 있는 속성이 포함된 후보키는 기본키로 부적합하다 
  - 단순한 후보키를 기본키로 한다 

4. 대체키 (alternate key)
- 기본키로 선택되지 못한 후보키를 의미한다 
- 고객 테이블의 고객이름, 주소와 같은 것들이 유일성과 최소성을 만족할 수 있지만 기본키로 채택되지 못하여 대체키가 된다. 

5. 외래키 
- 어떤 릴레이션에 소속된 속성 또는 속성 집합이 다른 릴레이션의 기본키가 되는 키다. 
- 외래키는 다른 테이블의 대체키를 참조하는 것도 가능하다.
- 외래키는 기본키를 참조하지만 기본키가 아니기 때문에 널값을 가질 수 있다. 


> Q. 외래키 자신이 속한 릴레이션의 기본키를 참조할 수 있나?

- YES
- 예를들어 고객 테이블에서 고객 릴레이션은 고객 아이디를 기본키로 할 수 있다. 추천고객 속성은 추천한 고객의 아이디를 의미하기 때문에 같은 릴레이션의 고객 아이디를 참조하는 외래키가 된다. 




## 2. 관계 데이터 모델의 제약

기본 제약사항은 키와 관련한 무결성 제약 조건이다.
무결성이란 데이터에 결함이 없는 상태를 의미한다. 데이터가 정확하고 유효하게 유지된 상태를 말한다. 
항상 두가지 조건을 모두 만족시켜야 데이터베이스의 상태를 일관성있게 유지할 수 있다. 

> Q. 개체 무결성 제약조건에 대해서 설명하세요

- 기본키를 구성하는 모든 속성은 널값을 가질 수 없다. 
- 기본키는 릴레이션의 튜플들을 유일하게 구별해주는 값이기 때문에 일부가 널값이 되면 유일성을 판단할 수 없어 기본키의 목적을 상실하게 된다. 

```sql

-- 1. 테이블 생성 시 PRIMARY KEY 선언
CREATE TABLE Employees (
    employee_id INT PRIMARY KEY, -- 기본키 설정
    name VARCHAR(50),
    age INT
);

-- 2. 테이블에 이미 존재하는 컬럼에 PRIMARY KEY 추가
ALTER TABLE Employees
ADD CONSTRAINT PK_Employees PRIMARY KEY (employee_id);

-- 3. INSERT 시 개체 무결성 위반 방지
INSERT INTO Employees (employee_id, name, age) VALUES (1, 'John Doe', 30);
INSERT INTO Employees (employee_id, name, age) VALUES (NULL, 'Jane Doe', 28);
-- ERROR: NULL 값은 기본 키에 삽입할 수 없습니다.


```


> Q. 참조 무결성 제약조건에 대해 설명하세세요

- 외래키는 참조할 수 없는 값을 가질 수 없다.
- 외래키는 다른 릴레이션의 기본키를 참조하는 속성이고 릴레이션간의 관계를 표현하는 역할을 한다. 그런데 이게 상관없는 값이 들어오면 연관시킬 수 없게 되어 외래키 본래의 의미를 상실하게 된다. 
- 값이 지속적으로 삽입, 삭제 되는 환경에서 이를 만족시키기는 쉽지 않기에 DBMS를 사용한다. 


```sql

-- 1. 테이블 생성 시 FOREIGN KEY 선언

CREATE TABLE Departments (
    department_id INT PRIMARY KEY,
    department_name VARCHAR(50)
);

CREATE TABLE Employees (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT,
    department_id INT,
    CONSTRAINT FK_Department 
        FOREIGN KEY (department_id) REFERENCES Departments(department_id)
);

-- 2. 데이터 삽입 시 참조 무결성 검사
INSERT INTO Departments (department_id, department_name) VALUES (1, 'HR');

INSERT INTO Employees (employee_id, name, age, department_id) 
VALUES (1, 'John Doe', 30, 1); -- 성공

INSERT INTO Employees (employee_id, name, age, department_id) 
VALUES (2, 'Jane Doe', 28, 2);
-- ERROR: 참조 무결성 위반 (2번 department_id가 Departments 테이블에 존재하지 않음)


-- 3. 테이블에 외래 키 추가
ALTER TABLE Employees
ADD CONSTRAINT FK_Department 
FOREIGN KEY (department_id) REFERENCES Departments(department_id);


```


# 예상 면접 질문 

> Q. 관계 데이터 모델에서 '도메인'이 왜 중요한가요?

- 도메인은 속성이 가질 수 있는 값의 집합입니다. 도메인을 정의하면 데이터베이스 시스템이 속성 값의 유효성을 검증할 수 있습니다.
- 예를 들어, 고객 테이블의 '등급' 속성의 도메인을 ['VIP', 'Gold', 'Silver', 'Bronze']로 설정하면, 이외의 값이 입력될 경우 이를 제한할 수 있습니다. 도메인을 정확하게 설정하면 데이터의 일관성과 무결성을 유지하는 데 큰 도움이 됩니다.


> Q. 기본키에 값이 자주 변경되는 속성을 사용하는 것이 왜 부적절한가요?

- 기본키는 테이블에서 각 튜플을 식별하는 유일한 값이기 때문에, 다른 테이블에서 외래키로 참조될 수 있습니다.
- 만약 기본키 값이 자주 변경된다면 이를 참조하는 모든 테이블의 데이터도 함께 수정되어야 합니다. 이는 데이터베이스의 성능에 큰 부하를 줄 뿐만 아니라 데이터의 일관성을 해칠 위험이 있습니다. 따라서 변경 가능성이 적고 안정적인 속성을 기본키로 사용하는 것이 바람직합니다.


> Q. 외래키가 자신이 속한 테이블의 기본키를 참조하는 경우는 어떤 상황인가요?

- 외래키가 자신이 속한 테이블의 기본키를 참조하는 경우는 자기참조 관계에서 발생합니다.
- 예를 들어, Employees 테이블에서 직원이 다른 직원을 추천하는 구조를 생각해보면, 추천 직원 ID는 같은 테이블의 employee_id를 참조하는 외래키가 됩니다.


> Q. ERD에서 다대다 관계를 논리적 데이터 모델로 변환할 때 어떻게 처리하나요?

다대다(N:M) 관계는 논리적 데이터 모델로 변환할 때 **중간 개체(연결 테이블)**를 생성하여 해결합니다.

다대다 관계를 표현하기 위해 **두 개체 사이에 새로운 개체(관계 테이블)**를 추가합니다.
중간 개체는 두 개체의 기본키를 외래키로 가져오고, 이를 결합하여 새로운 기본키로 설정합니다.
중간 개체에 추가적으로 필요한 속성(예: 거래 일자, 수량 등)이 있을 경우 함께 포함합니다.


```sql
CREATE TABLE 구매 (
    고객_ID INT,
    책_ID INT,
    구매일자 DATE,
    PRIMARY KEY (고객_ID, 책_ID),
    FOREIGN KEY (고객_ID) REFERENCES 고객(ID),
    FOREIGN KEY (책_ID) REFERENCES 책(ID)
);
```