# CH11 CPU스케줄링 

## 1. CPU 스케줄링 개요

- CPU 스케줄링 : 운영체제가 프로세스들에게 CPU자원을 배분하는 것. 

### 프로세스 우선순위 

- 프로세스가 먼저 CPU사용을 요청한다고 CPU를 사용할 수 있는것은 아님. 
- 우선순위가 다르기 때문이다. 우선순위가 높은 프로세스는 대표적으로 입출력 작업이 많은 프로세스. 
- 왜 효율적인가? 
  - 일반적인 프로세스들은 CPU와 입출력 장치를 모두 사용하며 실행된다. 즉 실행과 대기 상태를 반복해서 사용하게 된다. 
  - 프로세스 종류마다 입출력 장치를 이용하는 시간과 CPU를 이용하는 시간의 양에는 차이가 있다. (입출력이 많거나 / CPU 작업이 많거나 )
  - CPU집중 프로세스와 입출력 집중 프로세스가 동시에 CPU자원을 요구한다면, 입출력 집중 프로세스를 가능한 빨리 실행시켜서 입출력 장치를 끊임없이 작동시키고 그 다음 CPU집중 프로세스에 집중적으로 CPU를 할당하는 것이 효율적이다. 
  - +) CPU버스트 : CPU를 이용하는 작업, I/O버스트 : 입출력 장치를 기다리는 작업. 
  - 우선순위 확인하는 방법 `ps -el`


### 스케줄링 큐 

- OS에서 일일이 PCB에 적힌 우선순위를 찾는것은 너무 귀찮다. (시간이 오래걸림)
- 따라서 '줄을 서서 기다리게 할 것'을 요구한다. 이것을 스케줄링 큐라고 한다. 
  - 메모리로 적재되고 싶은, CPU를 이용하고 싶은, 입출력장치를 필요로 하는 프로세스를 큐에 삽입하여 줄을 세운다. 


### 대기 큐와 준비 큐 

- 준비 큐 : CPU를 이용하고 싶은 프로세스들이 서는 주를 의미하고 
- 대기 큐  입출력장치를 이용하기 위해 대기 상태에 접어든 프로세스들이 서는 줄을 의미한다. 

- 준비 상태에 있는 프로세스들의 PCB는 준비 큐의 마지막에삽입된다. 운영체제는 PCB들이 큐에 삽입된 큐에 순서대로 프로세스를 하나씩 꺼내 실행하되 그중 우선순위가 높은 프로세스를 먼저 실행한다. 

### 선점형과 비선점형 스케줄링 

- CPU가 사용중인 때에 다른 급한 프로세스가 CPU를 당장 사용하기를 원한다면? 
- CPU를 사용중인 프로세스로부터 CPU자원을 빼앗아 다른 프로세스에 할당할 수 있고, 작업중인 프로세스가 끝날때 까지 급한 프로세스를 기다리개 할 수 있다. 여기서 선점형/비선점형 방식으로 나뉜다 
- 선점형 스케줄링 : 프로세스가 진행중임에도 운영체제가 프로세스로부터 자원을 강제로 빼앗아 다른 프로세스에 할당하는 방식. (뺏을 수 있음음)
- 비선점형 스케줄링 : 프로세스가 진행중이라면 프로세스가 종료되거나 스스로 대기 상태에 접어들기 전까진 다른 프로세스가 끼어들 수 없는 스케줄링 방식을 의미한다. (뺏지못함)


## 2. CPU 스케줄링 알고리즘 


### 스케줄링 알고리즘의 종류 

1. 선입 선처리 스케줄링 (FCFS)
- First Come First Served Scheduling
- 비선점형 스케줄링 && 큐에 들어온 대로 프로세스를 처리하는 방식
- 만약 CPU를 오래 사용하는 프로세스가 들어온다면 다른 프로세스는 무작정 기다려야 한다. 
- 따라서 2ms 밖에 안걸리는 프로세스 앞에 20ms짜리 프로세스가 있다면 짧은 프로세스를 실행하기 위해 22ms를 써야하는 문제가 발생한다 -> 호위효과 

2. 최단 작업 우선 스케줄링 (SJF)
- Shortest Job First Scheduling
- 호위 효과를 방지하기 위해서 CPU사용이 짧은 간단한 프로세스를 먼저 실행한다. 
- 준비 큐에 삽입된 프로세스 중 CPU이용 시간 길이가 가장 짧은 프로세스부터 실행하는 방식을 의미한다.
- 비선점형 스케줄링으로 분류됨 

3. 라운드 로빈 스케줄링 
- Round robin scheduling
- 선입 선처리 스케줄링에 타임 슬라이스라는 개념이 추가된 방식 && 선점형
- 타임 슬라이스 : 각 프로세스가 CPU를 사용할 수 있는 정해진 시간을 의미한다. 
  - 문맥 교환이 발생하는 방식이다. 
  - 타임 슬라이스의 크기가 크면 호위효과가 생길 수 있고, 너무 작으면 문맥교환에발생하는 비용이 더 크게 된다. 

4. 최소 잔여 시간 우선 스케줄링 
- shortest Remaining Time 
- 우선스케줄링 알고리즘 + 라운드로빈 알고리즘 
- 정해진 타임 슬라이스만큼 CPU를 사용하되, CPU를 사용할 다음 프로세스는 남아있는 작업시간이 가장 적은 프로세스이다. 

5. 우선순위 스케줄링 
- 프로세스들에 우선순위를 부여하고, 가장 높은 우선순위를 가진 프로세스부터 실행한다. 
- 기아 현상이 발생할 수 있다 : 우선순위가 낮은 프로세스는 계속해서 뒤로 밀리는 문제. 
  - 이를 방지하기 위한 방법 == "에이징"
  - 오래 대기한 프로세스의 우선순위를 점차 높이는 방식이다. 

6. 다단계 큐 스케줄링 
- 우선순이 스케줄링의 발전된 형식 
- 우선순위 별로 준비 큐를 여러개 사용하는 것이다.
- 우선순위가 가장 높은 큐가 비어있으면 그 다음 우선순위 큐에 있는 프로세스를 처리한다. 
- 프로세스 유형별로 우선순위를 구부하여 실행하게 된다. 큐별로 타임 슬라이스를 여러개 지정할 수 있고, 큐마다 다른 스케줄링 알고리즘 사용하는 것도 가능하다!

7. 다단계 피드백 큐 스케줄링 (가장 일반적인 CPU스케줄링 알고리즘)
- 다단계 큐 스케줄링의 기아 현상을 보완한 기법 
- 프로세스들이 큐 사이를 이동할 수 있다. 
- 만약 프로세스가 해당 큐에서 실행이 끝나지 않는다면 다음 우선순위 큐에 삽입되어 실행된다. 
- 우선순위가 낮은 곳에서 너무 오래기다리고 있으면 우선순위가 높은 큐로 이동시키는 에이징 기법으로 기아 현상을 예방할 수 있다. 


