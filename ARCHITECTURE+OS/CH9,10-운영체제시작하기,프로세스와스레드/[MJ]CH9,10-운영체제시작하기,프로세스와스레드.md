# CH9 운영체제 시작하기 

## 운영체제를 알아야 하는 이유 

### 시스템자원 
- 프로그램 실행에 필요한 요소를 의미한다 
- CPU, 메모리, 보조기억장치, 입출력장치등이 모두 자원에 해당된다. 
  

### 운영체제 
- 실행할 프로그램에 자원을 할당하고 프로그램이 올바르게 실행되도록 돕는 프로그램을 운영체제라고 한다. 
- 운영체제도 프로그램이니 메모리에 적재되어야 한다. 
- 그러나 컴퓨터가 부팅될 때 메모리 내 커널 영역이라는 공간에 따로 적재된다. 해당 커널 영역을 제외한 응용 프로그램의 적재 구간을 사용자 영역이라고 한다. 
- 예를들어 워드프로세서와 메모장이 동시에 동일한 프린터를 사용한다고 하면 동시에 두개 프로그램이 프린터를 사용하지 못하도록 막는 것도 운영체제의 할일이다. 


### 왜 알아야 할까? 

- 만약 운영체제가 없다면 하드웨어를 조작하는 코드를 개발자가 모두 직접 작성해야 하기 때문이다.

## 운영체제의 큰그림 

- 운영체제란 사용자가 실행하는 "프로그램"을 위한 프로그램이다. 

### 커널 
- 운영체제 == 커널이라고 생각을 해보자. 커널은 운영체제의 핵심 기능을 담당한다. 
- 컴퓨터의 물리적 자원(하드웨어)와 추상화 자원을 관리한다. 추상화란 물리적으로 하나뿐인 하드웨어를 여러 사용자들이 번갈아 사용할 수 있도록 여러개인것처럼 보이게 하는 것이다. 


### 사용자 인터페이스 
- 운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스이다 
- 윈도우의 바탕화명이 예시
- GUI, CLI등이 있다. CLI는 명령어로 처리하는 화면


### 이중모드 
- 응용프로그램이 CPU, 메모리, 하드디스크등을 마음대로 접근 및 조작할 수 없고 운영체제를 통해 접근하도록 하여 자원을 보호한다. 
- 이중모드는 CPU가 명령어를 실행하는 모드를 사용자모드와 커널모드로 구분하는 형식이다.
- 사용자모드는 운영체제 서비스를 제공받을 수 없는 실행 모드이다. 일반적인 응용 프로그램은 기본적으로 사용자 모드로 실행된다. 
- 커널모드는 운영체제 서비스를 제공받을 수 있다. 즉 커널 영역의 코드를 실행할 수 있다. 


### 시스템 호출 

- 운영체제 서비스를 제공받기 위한 요청을 시스템 호출(시스템 콜)이라고 한다. 
- 시스템 호출은 일종의 인터럽트이다. 

### 운영체제의 핵심 서비스 


1. 프로세스 관리 
   - 실행중인 프로그램을 프로세스라고 한다. 
   - 일반적으로 하나의 CPU는 한번에 하나의 프로세스만 실행할 수 잇기 때문에 CPU는 이 프로세스들을 조금씩 번갈아가면서 실행한다. 
   - 이때 프로세스 동기화가 필수적이고, 더이상 실행되지 못한다면 교착상태가 발생하게 된다. 
  
2. 자원 접근 및 할당 
  - 모든 프로세스는 실행을 위해 자원이 필요하다. 
  - CPU : 한개의 CPU는 하나의 프로세스만 실행할 수 있다. 따라서 운영체제는 프로세스들에게 공정하게 CPU를 할당하기 위해 어떤 프로세스부터 CPU를 이용하게 할지 CPU스케줄링을 한다 .
  - 메모리 : 메모리에 적재된 프로세스들은 크기도, 주소도 가지각색이다. 그래서 운영체제는 새로운 프로세스가 적재될 때마다 어느 주소에 적재해야 할지 정해야 한다. 
  - 입출력 장치 : 인터럽트 서비스 루틴은 운영체제가 제공하는 기능으로 커널영역에 있다. 입출력 장치가 하드웨어 인터럽트 요청신호를 보내면 CPU는 하던일을 잠시 백업한 뒤 커널 영역에 있는 인터럽트 서비스 루틴을 실행한다. 

3. 파일 시스템 
   - 사용자 프로세스가 커널의 서비스를 제공받기 위해서는 사용자 모드에서 커널 모드로 전환해야 하고 이는 시스템 호출로 이루어진다. 

# CH10 프로세스와 스레드 

## 프로세스 개요 

- 컴퓨터가 부팅되는 순간 프로세스가 실행된다 
- 백그라운드에서 돌아가는 프로세스들이있다. 사용자와 상호작용 하지 않고 뒷편에서 돌아가는데 윈도우에서는 서비스, 유닉스에서는 데몬이라고 한다. 


### 프로세스 제어 블록 (PCB) 
- CPU의 개수가 한정적이기 때문에 프로세스 제어블록을 이용하여 실행순서를 관리하고 타이머 인터럽트를 발생시킨다. 
- PCB는 해당 프로세스를 식별하기 위해 꼭 필요한 정보들이 저장된다. 
  - PID: 특정 프로세스를 식별하기 위해 부여하는 고유한 번호이다 
  - 레지스터 값: 프로세스는 자신의 실행차례가 돌아오면 이전까지 사용했던 레지스터의 중간값들을 모두 복원한다. 
  - 프로세스 상태: 현재 프로세스의 상태를 저장한다 
  - CPU스케줄링 정보 : 프로세스가 언제 어떤 순서로 CPU를 할당받을지에 대한 정보도 기록된다. 
  - 메모리관리 정보 : 프로세스가 어느 주소에 저장되어있는지에 대한 정보가 있어야 한다. 
  - 사용할 파일과 입출력 장치 목록 : 프로세스가 실행 과정에서 특정 입출력장치나 파일을 사용하면 해당 내용이 PCB에 명시된다. 


### 문맥 교환 

- 프로세스에서 다른 프로세스로 실행 순서가 넘어가려면 각종 레지스터 값, 메모리정보, 실행을 위해 열었떤 파일이나 입출력장치를 기억해놓아야 한다. 이런 정보들을 문맥(context)이라고 한다. 그리고 해당 프로세스 문맥은 PCB에 표현되어있따. 


### 프로세스의 메모리 영역 
- 프로세스가 생성되면 커널 영역에 PCB가 생성된다. 하나의 프로세스는 사용자 영역에 코드영역, 데이터영역, 힙영역, 스택 영역으로 나뉘어서 저장된다. 
- 코드 영역 : 텍스트 영역이라고 한다. 기계어로 된 명령어가 저장된다. 쓰기가 금지되어있다. (read only)
- 데이터 영역 : 프로그램이 실행되는 동안 유지할 데이터가 저장된다. 이런 데이터는 전역변수가 대표적이다. 코드영역과 데이터 영역은 크기가 고정되어있다. 따라서 정적 할당 영역이다. 
- 힙 영역 : 프로그램을 만드는 사용자가 직접 할당할 수 있는 공간이다. 그리고 언젠가는 해당 공간을 반환해야 한다. 메모리 공간을 반환하지 않으면 메모리 낭비를 하게 되고 메모리 누수가 발생하게 된다. 
- 스택 영역 : 스택은 데이터를 일시적으로 저장하는 공간이다. 이런 데이터는 매개변수, 지역변수가 대표적이다. 일시적으로 저장할 데이터는 스택에 Push되고 필요없으면 Pop된다. 
- 힙영역과 스택 영역은 실시간으로 크기가 변할 수 있기 때문에 동적할당 영역이라고 한다. 


## 프로세스 상태와 계층 구조 

### 프로세스 상태 
- 하나의 프로세스는 여러 상태를 거치며 실행된다. 운영체제는 상태를 PCB를 통해 인식하고 관리한다. 프로세스가 가질 수 있는 상태는 생성, 준비, 실행, 대기 종료가 있다. 

1. 생성 상태 
   - 프로세스를 생성 중인 상태를 의미한다. 
   - 곧바로 실행되지는 않고 준비상태가 되어 CPU의 할당을 기다린다 

2. 준비 상태 
   - 당장이라도 CPU를 할당받아 실행할 수 있지만 내 차례는 아니어서 기다리고 있다. 

3. 실행 상태 
   -  CPU를 할당받아 실행중인 상태를 의미한다. 
   -  실행 상태인 프로세스는 할당된 일정 시간 동안만 CPU를 사용할 수 있다. 

4. 대기 상태 
   - 실행 도중 입출력장치를 사용하는 경우가 있다. 입출력은 CPU에 비해 처리속도가 느려서 입촐력 작업을 요청한 프로세스는 입출력 장치가 작동을 끝낼때 까지 기다려야 한다. 이런 상태를 대기상태라고 한다. 

5. 종료 상태 
   - 프로세스가 종료된 상태이다. 

### 프로세스의 계층 구조 
- 프로세스는 실행 도중 시스템 호출을 통해 다른 프로세스를 생성할 수 있다. 이때 새 프로세스를 만든 프로세스를 부모 프로세스, 생성된 프로세스는 자식 프로세스라고 한다. 
- 엄연히 다른 프로세스이기에 각기 다른 PID를 가진다. 자식 프로세스의 PCB에는 부모의 PID인 PPID가 기록된다. 
- 컴퓨터 부팅을 하면 프로세스들이 자식 프로세스를 생성하는데 이 과정을 그리면 트리 구조를 띈다. 
- 프로세스 트리의 가장 위에 있는 최초의 프로세스는 유닉스는 init, 리눅스는 systemd, mac에서는launchd이다. PID가 1이다. 


### 프로세스 생성 기법 
- 복제와 옷갈아입히기를 통해 실행된다. fork, exec는 시스템 호출이다. 
- fork : 자신의 복사본으로 자식 프로세스를 생성한다 
- exec : 만들어진 자식 프로세스를 통해 자신의 메모리공간을 다른 프로그램으로 교체한다. (덮어쓰기) 즉 새로운 프로그램 내용으로 전환하여 실행하는 시스템 호출이다. 


## 스레드 
- 단일 스레드 프로세스 : 실행 흐름이 하나여서 한번에 하나의 부분만 실행되는 것이다. 
- 멀티스레드 프로세스 : 한번에 여러 일을 동시에 처리할 수 있게 되었다. 
- 스레드는 프로세스를 구성하는 실행 단위로 이해할 수 있다. 프로세스의 스레드들은 실행에 필요한 최소한의 정보를 유지한 채 프로세스 자원을 공유하며 실행되는 것이다. 
