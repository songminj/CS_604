# CH5 CPU 성능향상기법

## 5-1. 빠른 CPU를 위한 설계 기법 

### 클럭 

- 컴퓨터 부품은 클럭의 신호에 맞춰 움직인다. 
- 클럭 속도는 CPU속도 단위로 간주되기도 한다. 
- 오버클럭킹 : 최대클럭 속도를 강제로 끌어올리는 것

### 코어와 멀티코어 

클럭 속도를 높이는 방법 외에 CPU의 성능을 높이는 방법. 


1. CPU코어의 수를 늘리는 방법 

- 코어 : 명령어를 실행하는 부품을 말한다. 
  - 여러개의 코어를 포함하고 있는 CPU를 멀티코어CPU, 멀티코어 프로세서라고 한다. 
  - 그러나 코어의 수를 2, 3, 100배로 늘린다고 연산 처리속도가 비례해서 늘어나지는 않는다. 
  - 코어에 떨어지는 명령어들을 얼마나 적절하게 분배하느냐가 연산 속도에 영향을 준다. 



### 스레드와 멀티스레드 

CPU의 성능을 높이는 2번째 방법은 스레드 수를 늘리는 것이다. 

1. 스레드
   - 실행 흐름의 단위이다. 
   - 스레드에는 CPU에서 사용되는 하드웨어적 스레드가 있고 프로그램에서 사용되는 소프트웨어적 스레드가 있다. 

2. 하드웨어적 스레드 (= 논리프로세스 ㄴ)
   - HW적 스레드 : 하나의 코어가 동시에 처리하는 명령어 단위를 의미한다. 
   - 멀티스레드 프로세서 : 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 의미한다

3. 소프트웨어적 스레드 
  - SW적 스레드 : 하나의 프로그램에서 독립적으로 실행되는 단위를 의미한다. 여기서 싱글 스레드는 한 부분만 실행되는 것이고 멀티스레드가 한번에 프로그램의 여러 부분이 동시에 실행되는 것이다 .

4. 멀티스레드 프로세서 
   - 레지스터가 여러개 필요하다. 


## 5-2. 명령어 병렬 처리 기법


### 명령어 파이프라인

명령어 처리과정을 클럭단위로 나누면 
1. 명령어 인출 
2. 명령어 해석 
3. 명령어 실행 
4. 결과 저장 
으로 나눌 수 있따. 


각 단계가 겹치지만 않는다면 CPU는 각 단계를 동시에 실행할 수 있다는 것이다. 이렇게 겹쳐서 실행되는 것을 명령어 파이프라인이라고 한다. 

파이프라이닝은 높은 성능을 가져오기는 하지만 특정 상황에서 성능향상에 실패하는 경우도 있다. 


1. 데이터 위험 
   - 명령어 간 데이터 의존성에 의해 발생한다. 
   - 모든 명령어를 동시에 처리할 수  없다. 예를들어 명령어 1의 결과값을 명령어 2에서 사용해야 할 때가 있다. 명령어 1의 결과값이 저장되지 않았을 때 명령어 2를 인출하게 되면 올바르지 않은 값으로 명령어 2를 수행하게 된다. 

2. 제어 위험 
   - 분기 등으로 인한 프로그램 카운터의 갑작스러운 변화에 의해 발생한다. 
   - 기본적으로 프로그램 카운터는 현재 실행중인 명령어의 다음 주소로 갱신된다. 
   - 근데 실행 흐름이 바뀌어 변화가 생긴다면 미리 인출, 해석해놓은 명령어가 쓸모가 없어진다. 

3. 구조적 위험 
   - 명령어들을 겹쳐 실행하는 과정에서 서로다른 명령어가 동시에 ALU, 레지스터 등과 같은 CPU부품을 사용하려고 할 때 발생한다. 


### 슈퍼스칼라 

- 대부분의 CPU에서는 여러개의 파이프라인을 이용한다. 
- 여러개의 명령어 파이프라인을 포함한 구조를 슈퍼스칼라라고 한다.
- 슈퍼스칼라 프로세서/슈퍼스칼라 CPU : 슈퍼스칼라 구조로 명령어 처리가 가능한 CPU
- 이론적으로는 슈퍼스칼라 프로세서는 파이프라인 개수에 비례해서 속도가 빨라진다. 그러나 파이프라인의 예상치 못한 문제 때문에 비례해서 빨라지지는 않는다. 

### 비순차적 명령어 처리 

- 비순차적 명령어 처리를 OoOE로 줄여서 부른다. 
- 순서를 바꿔 실행해도 무방한 명령어를 먼저 실행하여 명령어 파이프라인이 멈추는 것을 방지하는 기법을 의미한다. 

## 5-3 CISC와 RISC 

### 명령어 집합 

- ISA : 명령어 집합 구조를 말한다. 
- 인텔 노트북은 x86-64 ISA를 이해하고 애플 CPU는 ARM ISA를 이해한다. 


### CISC

- Compex Instruction Set Computer
- 복잡한 명령어 집합을 활용하는 컴퓨터 
  - 가변 길이 명령어를 활용한다. 
  - 그러나 활용하는 명령어가 복잡하고 다양한 기능을 제공하기 때문에 명령어의 크기와 실행되기 까지의 시간이 일정하지 않다. 
  - 따라서 명령어 파이프라인을 구현하는데 큰 걸림돌이 된다. 

### RISC

- 빠른 처리를 위해 명령어 파이프라인을 사용해야하는데 이를 위해선 명령어 길이와 수행시간이 짧고 규격화 되어있어야 한다. 
- 복잡한 기능을 지원하는 명령어를 추가하는 것보다 자주 쓰이는 기본적인 명령어를 작고 빠르게 만드는 것이 중요하다. 
- RISC : Reduced Instruction Set Computer
  - 명령어가 규격화되어있고 하나의 명령어가 1클럭내외로 실행된다. 
  - 레지스터를 적극 활용한다. 