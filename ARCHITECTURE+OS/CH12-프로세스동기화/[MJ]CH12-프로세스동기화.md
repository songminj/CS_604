# CH12 프로세스 동기화 


## 12-1. 동기화란 

### 동기화의 의미 

동기화란? 
- 동시다발적으로 실행되는 프로세스는 실행순서와 자원의 일관성을 보장해야 한다. 
- 동기화란, 작업들 사이의 수행 시기를 맞추는 것을 의미한다. 
  - 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기 (ex: read/write를 할 떄 write가 끝나야 read할 수 있음)
  - 상호 배제 : 동시에 접근해서는 안되는 자원에 하나의 프로세스만 접근하게 하기 (ex: 계좌에 동시에 두개의 다른 값을 insert할 때)


### 생산자와 소비자 문제
- 공유 버퍼를 사이에 두고 생산자와 소비자간 공유 버퍼를 문제없이 사용하도록 생산자와 소비자를 동기화시키는 문제를 의미한다. 
- 생산자는 뭔갈 추가함/ 소비자는 뭔갈 소비함. 이때 두 생산자, 소비자 코드가 동시에 실행 될 때 문제가 발생한다. 
  - 고려해야 할 점 3가지. 
    - 상호 배제 해결 : 생산자들과 소비자들의 공유 버퍼에 대한 상호 배제 
    - 비어있는 공유 버퍼 문제 해결 : 비어있는 공유 버퍼를 소비자가 읽지 않도록 함. 
    - 꽉찬 공유 버퍼 문제 : 꽉찬 공유 버퍼에 생산자가 더이상 데이터를 입력해서는 안된다. 
  - 해결 방법 === 세마포어 2개를 이용한다. 

### 공유 자원과 임계 구역 

공유 자원 : 여러 프로세스에서 공동으로 사용하게 되는 변수를 의미한다. 전역변수, 파일, 입출력장치, 보조기억장치가 될 수 있다. 
임계 구역 : 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역 
레이스 컨디션 : 여러 프로세스가 동시다발적으로 임계 구역의 코드를 실행하여 문제가 발생한다. 
  - 문제: 데이터 일관성이 깨지게 된다. 
  - 원인 : 컴퓨터는 고급언어에서 저급 언어로 명령을 변환한다. 이 뗴 여러줄의 저급언어로 변환된 고급언어 한줄을 실행하는 과정에서 문맥교환이 발생할 수 있다. 
  - 해결 : 상호배제를 위한 동기화는 이와 같은 일이 발생하지 않도록 두개 이상의 프로세스가 임계 구역에 동시에 접근하지 못하도록 관리하는 것을 의미한다. 

## 12-2. 동기화기법 

### 뮤텍스 락
- 동시에 접근해서는 안되는 자원에 동시에 접근하지 않도록 하는 도구이다. 
- 상호배제를 위한 동기화 도구. 
- 임계구역에 진입하는 프로세스는 내가 지금 임계구역에 있음을 알리기 위해 뮤텍스 락을 이용해 임계 구역에 자물쇠를 걸어둘 수 있다. 다른프로세스는 자물쇠가 걸려 있으면 기다리고 아니면 임계구역으로 들어간다. 


### 뮤테스락의 형태 

- Lock : 프로세스들이 공유하는 전역변수를 잠금 
- acquire 함수 : 임계 구역을 잠그는 역할 
- release 함수 : 임계 구역의 잠금을 해제하는 역할 


- C/C++, Python의 프로그래밍언어에서는 사용자가 직접 acquire, release함수를 구현하지 않도록 뮤텍스 락 기능을 제공한다. 


### 세마포

- 뮤텍스 락과 비슷하지만 조금 더 일반화된 방식의 동기화 도구이다 
- 공유자원이 여러개ㅔ 있을 경우, 여러개의 프로세스가 각각 공유 자원에 접근이 가능해야 한다. 


### 세마포의 형태 

- 전역변수 S : 임계 구역에 진입할 수 있는 프로세스의 개수를 나타낸다 
- wait 함수 : 임계 구역에 들어가도 좋은지, 기다려야 할지를 알려주는 함수 
- signal 함수 : 임계 구역 앞에서 기다리는 프로세스에 이제 가도 좋다고 신호를 주는 함수 

- 단점 : 뮤텍스락과 세마포어는 사용할 수 있는 공유자원 S가 없으면 무한히 반복하며 S를 확인해야 한다. CPU주기를 낭비한다는 점에서 손해이다. 
- 해결 방법 : wait 함수는 만일 사용할 수 있는 자원이 없을 경우 해당 프로세스 상태를 대기 상태로 만들고, 그 프로세스의 PCBㄹㄹ 세마포를 위한 대기 큐에 집어넣는다. 

### 모니터 

- 임계 구역에 앞뒤로 일일이 wait과 signal 함수를 붙이는건 번거롭다. 
- 이를 해결하는 도구가 모니터이다. 
- 모니터는 공유자원에 접근하기 위한 인터페이스를 묶어서 관리한다. 프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근하도록 한다. 
- 조건 변수 : 프로세스를 실행하고 중단하기 위해 변수를 두어 프로세스나 스레드의 실행순서를 제어한다. 
- 특정 프로세스가 아직 실행될 조건이 되지 않았을 때에는 wait를 통해 실행을 중단한다.
- 특정 프로세스가 실행될 조건이 충족되었을 때에는 signal을 통해 실행을 재개한다
