# CH 13 - 교착상태 

## 13-1 교착상태란 


### 식사하는 철학자 문제 

- 식사하는 철학자 문제란... 
  - 원탁에 5명의 철학자들이 앉아있다. 
  - 식탁에는 맛있는 식사가 있고, 철학자들 사이사이에는 식사에 필요한 포크가 있다. 철학자들 앞에 있는 식사는 두개의 포크로 먹을 수 있는 음식이다. 
  - 이때 철학자들은 아래와 같은 순서로 밥을 먹는다. 
    1. 계속 생각하다가 왼쪽 포크가 사용 가능 상태면 집어든다
    2. 계속 생각하다가 오른쪽 포크가 사용 가능한 상태면 집어든다 
    3. 왼쪽/오른쪽 포크를 들고 정해진 시간동안 식사를 한다 
    4. 식사를 끝내면 오른쪽 포크를 내려논다 
    5. 오른쪽 포크를 내려놓으면 왼쪽 포크를 내려놓는다 
    6. 다시 1번부터 반복
  - 이렇게 하면 모든 철학자가 동시에 포크를 집어 식사를 하게 되면 어떤 철학자도 식사를 할 수없다. 

- 이렇게 일어나지 않을 사건을 기다리며 진행이 멈춰버리는 현상을 교착상태라고 한다. 
- 철학자  = 프로세스 (스레드) /  포크 = 자원 / 생각하는 행위 = 자원을 기다리는 것 / 포크를 한번에 하나 잡는것 = 임계구역 



### 자원 할당 그래프 

- 교착상태는 자원 할당 그래프를 통해 단순하게 표현할 수 있다. 
  - 프로세스는 원으로 자원의 종류는 사각형으로 표시한다 
  - 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표시한다. 
    - 예를들어 하드디스크 세개 : 점 3개 찍기 
  - 프로세스가 어떤 자원을 할당받아 사용중이라면 자원에서 프로세스를 향해 화살표를 표시한다. (자원 --> 프로세스)
  - 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표를 표시한다. (프로세스 --> 자원)
- 그림을 그려보면 교착상태가 일어나는 그래프는 원의 형태를 띄고 있다. 


### 교착 상태 발생 조건 

- 상호배제, 점유와 대기, 비선점, 원형 대기 

1. 상호 배제 
- 해당 자원을 한번에 하나의 프로세스만 이용 가능했기 때문이다. 
- 상호배제란 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때를 의미한다. 

2. 점유와 대기 
- 식사하는 철학자 문제에서 철학자는 왼쪽 포크를 들고 오른쪽 포크를 기다렸기 때문에 문제가 발생하였다. 
- 어떤 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태를 점유와 대기라고 한다.

3. 비선점 
- 만약 철학자들이 누군가의 포크를 강제로 빼앗을 수 있었다면 교착상태는 발생하지 않았을 것이다. 그러나 식사하는 철학자 문제에서는 그냥 기다렸다. 
- 교착상태가 발생하는 원인중에는 프로세스가 자원을 비선점하고 있기 때문이다. 

4. 원형 대기 
- 프로세스들과 프로세스가 요청 할당받은 자원이 원의 형태를 이루었기 때문이다. 


## 13-2 교착 상태 해결 방법 

### 교착 상태 예방
- 자원의 상호 배제를 없엔다. 
  - 즉 모든 자원을 공유 가능하게 만든다는 것이다 (좀 무리임)
- 점유와 대기를 없엔다. 
  - 특정 프로세스에 자원을 모두 할당하거나 아예 할당하지 않는 방식으로 배분한다. 
  - 이론적으로는 교착상태를 해결할 수 있지만 자원의 활용률이낮아진다. 
  - 금지하게되면 많은 자원을 사용하는 프로세스가 불리해진다. 그래서 기아 현상이 발생할 수 있음 
- 비선점 조건을 없엔다. 
  - 일부 자원에 대해서는 효과적이다. 
  - 한 프로세스가 CPU를 이용하다가 일정 시간이 지나면 작업이 모두 끝나지 않았어도 다른 프로세스가 CPU를 할당받아 사용할 수 있기 때문이다. 
  - 그치만 프린터같이 한 프로세스의 작업이 끝날때까지 기다려야 하는 프로세스들도 있다. 이러면 범용성이 떨어진다. 
- 원형대기를 없엔다. 
  - 간단하다. 모든 자원에 번호를 붙이고 오름차순으로 자원을 할당하면 원형 대기는 발생하지 않는다. 
  - 그러나 컴퓨터 시스탬 네의 수많은 자원에 번호를 붙이는 일은 간단하지 않다. 
  - 번호를 어떻게 붙이냐에 따라 자원의 활용률이 떨어진다. 


### 교착 상태 회피 

- 교착상태 회피에서는 교착상태를 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주한다. 

### 교착 상태 검출 후 회복 

- 교착상태 발생을 인정하고 사후에 조치하는 방식이다. 

