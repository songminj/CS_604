# Chapter 13. 교착 상태
## 13-1 교착 상태란
### 식사하는 철학자 문제
- dining philosophers problem. 교착상태를 설명하기 위한 고전적인 문제
- 원탁에 앉은 철학자들은 양쪽 포크를 집어들어야 식사가 가능하다.
- 이때, 모든 철학자가 자신의 왼쯕 포크를 든 상황이라면 그 누구도 식사를 할 수 없다.
- 이 경우를 교착상태(Deadlock)이라고 한다.

### 자원 할당 그래프
- 교착상태는 자원 할당 그래프를 통해 단순하게 표현 가능
  - 프로세스는 원으로, 자원의 종류는 사각형으로 표현
  - 사용할 수 있는 자원의 개수는 사각형 내 점으로 표현
  - 프로세스가 어떤 자원을 할당받아 사용 중이라면 자원에서 프로세스를 향해 화살표를 표시
  - 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표를 표시
- 자원 할당 그래프가 원의 형태를 띄운다면 교착 상태가 발생한 상황

### 교착 상태 발생 조건
- 상호 배제: 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없어야 한다.
- 점유와 대기: 자원을 할당받은 상태에서 다른 자원을 할당받기 기다리는 상태여야 한다.
- 비선점: 획득한 자원을 다른 프로세스가 강제로 빼앗지 못해야 한다.
- 원형 대기: 프로세스들이 원의 형태로 자원을 대기해야 한다.

## 13-2 교착 상태 해결 방법
### 교창 상태 예방
- 교착 상태 발생 조건 4가지 중 하나를 충족하지 못하게 하는 방법
- 상보 해제 제거: 
  - 모든 자원이 공유 가능해야 한다는 의미. 현실적으로 불가능(프린터 등)
- 점유와 대기 제거: 
  - 이론적으로 가능. 필요 자원을 동시에 점유하거나, 아예 점유하지 못하게 제한
  - 다만, 자원의 활용률이 낮아짐(자원이 대기하게 됨). 많은 자원을 사용하는 프로세스가 불리해짐. 기아 현상 발생 가능
- 비선점 제거: 
  - 다른 프로세스 자원을 빼앗을 수 있다면 교착 상태 해결 가능
  - 다만, 모든 자원이 선점 가능하지 않음(프린터 등). 범용성이 떨어짐
- 원형 대기 제거:
  - 모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당
  - 다만, 컴퓨터 내 모든 자원에 번호를 붙이는 작업은 어려우며, 자원의 활용률이 떨어짐

### 교착 상태 회피
- 교착 상태가 발생하지 않을 정도로만 자원을 할당하는 방식
- 자원의 양을 고려해 교착 상태가 발생하지 않을 정도로만 자원을 배분

용어
- 안전 상태: safe state. 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
- 불안전 상태: unsafe state. 교착 상태가 발생할 수도 있는 상황
- 안전 순서열: safe sequence. 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서

### 교착 상태 검출 후 회복
- 교착 상태 발생을 인정하고 사후에 조치하는 방식
- 선점을 통한 회복: 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
- 프로세스 강제 종료를 통한 회복: 교착 상태인 프로세스 모두 종료 or 하나씩 종료