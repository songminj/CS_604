# Chapter 3. 네트워크 계층
## 03-1 LAN을 넘어서는 네트워크 계층

- LAN을 넘어 다른 네트워크와 통신하기 위해선 네트워크 계층이 필수
- IP 주소를 이용해 송수신지 대상을 지정하고, 라우팅으로 통신

### 데이터 링크 계층의 한계
1. 물리 계층과 데이터 링크 계층만으로는 다른 네트워크까지의 도달 경로를 파악하기 어려움
    - 라우팅: 패킷이 이동할 최적의 경로를 결정하는 것
    - 라우터: 라우팅을 수행하는 장비
2. MAC 주소만으로는 모든 네트워크에 속한 호스트의 위치를 특정하기 어려움
    - MAC 주소(물리 주소)는 택배의 수신인 역할을 하는 정보.
    - IP 주소(논리 주소)는 수신지 역할을 하는 정보
      - DHCP로 IP 주소를 자동으로 할당받거나 직접 할당 가능

### 인터넷 프로토콜
IP(Internet Protocol): 네트워크 계층의 가장 핵심적인 프로토콜
- 버전: IPv4, IPv6
- 형태: 4바이트. 0~255 범위 안에 있는 4개의 10진수로 표기. 각 진수는 점으로 구분되며 구분된 8비트를 옥텟(octet)이라고 함.
  - 192.168.1.1
- 기능: 
  1. IP 주소 지정(IP addressing): IP 주소를 바탕으로 송수신 대상을 지정하는 것
  2. IP 단편화(IP fragmentation): 전송하고자 하는 패킷의 크기가 MTU(최대 전송 단위)보다 클 경우, 이를 MTU 이하의 복수의 패킷으로 나누는 것
      - MTU(Maximum Transmission Unit): 한 번에 전송 가능한 IP 패킷의 최대 크기. IP 패킷의 헤더도 이 크기에 포함됨. 일반적으로 1500byte

### IPv4 패킷 내용
1. 식별자: 패킷에 할당된 번호. 재조합 시 사용
2. 플래그: 총 3개의 비트로 구성된 필드. 첫 번째 비트는 항상 0으로 예약된 비트로 현재 사용되지 않음. 나머지 두 개 중 하나는 DF(Don't Fragment)이며, IP 단편화를 수행하지 말라는 표시(1이면 수행 X, 0이면 수행 O). 다른 하나는 MF(More Fragment)로, 단편화된 패킷이 더 있는지를 나타냄. 0이면 마지막 패킷이며, 1이면 더 있다는 의미.
3. 단편화 오프셋: 패킷이 단편화되기 전에 패킷의 초기 데이터에서 몇 번째로 떨어진 패킷인지 나타냄
4. TTL: Time To Live. 멀리 떨어진 호스트끼리 통신할 때 패킷은 여러 라우터를 거치는데, 하나 거칠때마다 1씩 감소하며 TTL이 0이면 폐기됨. 패킷이 호스트 or 라우터에 한 번 전달되는 것을 홉(hop)이라고 함
5. 프로토콜: 상위 계층의 프로토콜이 무엇인지를 나타내는 필드(TCP: 6, UDP: 17)
6. 송신지와 수신지 IP 주소

### IPv6 패킷내용
IPv6는 16byte로 주소를 표현할 수 있고, 콜론으로 구분된 8개의 그룹의 16진수로 표현됨
1. 다음 헤더: 상위 계층의 프로토콜 혹은 확장 헤더를 가리킴
2. 홉 제한: TTL 필드와 유사
3. 송신지와 수신지 IP 즈소

### ARP
ARP: Address Resolution Protocol. IP 주소를 통해 MAC 주소를 알아내는 프로토콜. 동일 네트워크 내에 있는 송수신 대상의 IP 주소를 통해 MAC 주소를 알아낼 수 있음  
동작 과정
1. ARP 요청: 네트워크 내 모든 host에게 브로드캐스트 메시지를 보냄
2. ARP 응답: IP 주소가 다르면 무시, 같으면 자신의 MAC 주소를 전송. 유니캐스트 메시지를 보냄
3. ARP 테이블 갱신: IP 주소와 그에 맞는 MAC주소 테이블을 대응하는 표

